# Use-case Narrative: Регистрация и вход в систему

**Автор:** AlexandraR    
**Дата:** 19.09.2025    
**Версия:** 1.0

## 1. Краткое описание
Новый пользователь (продавец или аналитик) создает учетную запись в системе анализа отзывов через процесс регистрации. Существующий пользователь входит в систему с помощью email и пароля. Система обеспечивает безопасную аутентификацию, подтверждение email и восстановление доступа при необходимости.

## 2. Участники (Actors)
- **Новый пользователь:** Продавец или аналитик, который впервые использует систему.
- **Существующий пользователь:** Зарегистрированный пользователь, имеющий учетную запись в системе.

## 3. Pre-conditions
- Пользователь имеет доступ к интернету.
- Пользователь имеет действующий email адрес.
- Система аутентификации и база данных пользователей работают и доступны.

## 4. Post-conditions
- **Успех регистрации:** Создана новая учетная запись, пользователь подтвердил email и вошел в систему.
- **Успех входа:** Пользователь аутентифицирован и получил доступ к личному кабинету.
- **Неудача:** Пользователь получает информативное сообщение об ошибке с рекомендациями по исправлению.

## 5. Детальные сценарии

### 5.1. Happy Path (Основной успешный сценарий)

#### Регистрация нового пользователя
| Шаг | Действие Пользователя | Ответ Системы |
|-----|----------------------|---------------|
| 1 | Пользователь нажимает кнопку "Регистрация" на главной странице. | Система открывает форму регистрации с полями: email, пароль, подтверждение пароля. |
| 2 | Пользователь заполняет все обязательные поля валидными данными. | Система validates данные в реальном времени (формат email, сложность пароля, совпадение паролей). |
| 3 | Пользователь нажимает кнопку "Зарегистрироваться". | Система отображает индикатор загрузки. |
| 4 | ... | Backend проверяет уникальность email в базе данных. |
| 5 | ... | Система создает запись пользователя в базе (с хешированием пароля) и генерирует verification token. |
| 6 | ... | Система перенаправляет пользователя в личный кабинет с приветственным сообщением. |

#### Вход существующего пользователя
| Шаг | Действие Пользователя | Ответ Системы |
|-----|----------------------|---------------|
| 1 | Пользователь нажимает кнопку "Войти" на главной странице. | Система открывает форму входа с полями: email и пароль. |
| 2 | Пользователь вводит email и пароль. | Система validates формат email. |
| 3 | Пользователь нажимает кнопку "Войти". | Система отображает индикатор загрузки. |
| 4 | ... | Backend проверяет существование пользователя и сверяет хеш пароля. |
| 5 | ... | Система создает JWT token и сессию. |
| 6 | ... | Система перенаправляет пользователя в личный кабинет. |

**Ценность для пользователя:**
- **Быстрый старт:** Минимальный набор полей для регистрации позволяет начать работу с системой за несколько минут.
- **Безопасность:** Хеширование паролей и email подтверждение обеспечивают защиту учетной записи.
- **Удобство:** Автоматический вход после подтверждения email исключает лишние шаги.

### 5.2. Alternative Flows (Альтернативные сценарии)

#### A.1: Вход через социальные сети
| Шаг | Действие Пользователя | Ответ Системы |
|-----|----------------------|---------------|
| 1 | Пользователь нажимает кнопку "Войти через Google/Github". | Система перенаправляет на OAuth провайдера. |
| 2 | Пользователь авторизуется у провайдера и разрешает доступ. | Провайдер перенаправляет обратно в систему с токеном. |
| 3 | ... | Система создает или обновляет учетную запись пользователя на основе данных от провайдера. |
| 4 | ... | Система автоматически авторизует пользователя и перенаправляет в личный кабинет. |

**Ценность для пользователя:**
- **Упрощенный процесс:** Отсутствие необходимости запоминать еще один пароль.
- **Экономия времени:** Регистрация и вход в 2 клика.

#### A.2: Повторная отправка письма подтверждения
| Шаг | Действие Пользователя | Ответ Системы |
|-----|----------------------|---------------|
| 1 | Пользователь не получил письмо и нажимает "Отправить письмо повторно". | Система проверяет лимиты на отправку писем. |
| 2 | ... | Система генерирует новый token и отправляет письмо. |
| 3 | ... | Система показывает сообщение: "Письмо отправлено повторно. Проверьте папку Спам." |

**Ценность для пользователя:**
- **Самостоятельное решение проблем:** Пользователь может решить проблему с недоставкой письма без обращения в поддержку.
- **Контроль:** Возможность управлять процессом подтверждения email.

### 5.3. Error Handling (Обработка ошибок)

#### E.1: Неверные учетные данные при входе
| Шаг | Действие Пользователя | Ответ Системы |
|-----|----------------------|---------------|
| 1 | Пользователь вводит неверный email или пароль. | Backend возвращает ошибку аутентификации. |
| 2 | ... | Frontend показывает сообщение: "Неверный email или пароль. Проверьте правильность ввода." |
| 3 | ... | Система предлагает кнопку "Восстановить пароль". |

**Ценность для пользователя:**
- **Безопасность:** Система не уточняет, что именно неверно (email или пароль), чтобы избежать подбора.
- **Быстрое восстановление:** Сразу доступен вариант решения проблемы.

#### E.2: Email уже занят при регистрации
| Шаг | Действие Пользователя | Ответ Системы |
|-----|----------------------|---------------|
| 1 | Пользователь пытается зарегистрироваться с email, который уже есть в системе. | Backend проверяет уникальность и возвращает ошибку. |
| 2 | ... | Frontend показывает сообщение: "Пользователь с таким email уже зарегистрирован. Войдите или восстановите пароль." |
| 3 | ... | Система предлагает кнопки "Войти" и "Восстановить пароль". |

**Ценность для пользователя:**
- **Направление к решению:** Четкие инструкции что делать в данной ситуации.
- **Экономия времени:** Пользователь сразу переходит к решению проблемы.

#### E.3: Слабый пароль при регистрации
| Шаг | Действие Пользователя | Ответ Системы |
|-----|----------------------|---------------|
| 1 | Пользователь вводит слишком простой пароль. | Валидация на frontend показывает требования: "Пароль должен содержать 8+ символов, буквы и цифры." |
| 2 | Пользователь нажимает "Зарегистрироваться" с weak password. | Система блокирует отправку формы и подсвечивает поле с ошибкой. |
| 3 | ... | Сообщение: "Пароль слишком простой. Используйте буквы в разных регистрах, цифры и специальные символы." |

**Ценность для пользователя:**
- **Безопасность аккаунта:** Защита от взлома простых паролей.
- **Обучение:** Пользователь узнает о лучших практиках безопасности.

## 6. Use-case UML Диаграмма

```mermaid
graph TD
    A[Пользователь] -->|1. Нажимает Регистрация/Вход| B(UI: Форма аутентификации)
    B -->|2. Заполняет форму| A
    A -->|3. Отправляет форму| B
    
    subgraph "Регистрация"
        B -->|4. Валидация данных| C{Данные валидны?}
        C -->|Нет| D[Ошибка валидации]
        C -->|Да| E[Проверка уникальности email]
        E -->|Занят| F[Ошибка: Email занят]
        E -->|Свободен| G[Создание пользователя]
        G --> H[Отправка письма подтверждения]
        H --> I[Ожидание подтверждения]
        I --> J[Подтверждение email]
        J --> K[Успешная авторизация]
    end

    subgraph "Вход"
        B -->|5. Валидация данных| L{Данные валидны?}
        L -->|Нет| M[Ошибка валидации]
        L -->|Да| N[Проверка учетных данных]
        N -->|Неверны| O[Ошибка: Неверные данные]
        N -->|Верны| P[Создание сессии]
        P --> Q[Успешная авторизация]
    end

    D -->|Показ ошибки| B
    F -->|Показ ошибки| B
    M -->|Показ ошибки| B
    O -->|Показ ошибки| B
    
    K -->|Перенаправление в ЛК| R(UI: Личный кабинет)
    Q -->|Перенаправление в ЛК| R
    R -->|Доступ к системе| A

    subgraph "Обработка ошибок"
        S[Сервис email недоступен] -->|Ошибка отправки| T[Ошибка: Сервис недоступен]
        U[База данных недоступна] -->|Ошибка соединения| V[Ошибка: Системная ошибка]
    end

    E -.-> U
    N -.-> U
    H -.-> S
    
    T -->|Показ ошибки| B
    V -->|Показ ошибки| B
